<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout">

<head>
    <meta charset="utf-8" />



    <link type="text/css" rel='stylesheet' th:href="@{/public/skinqln/vendor/bootstrap/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/public/skinqln/vendor/slick/slick.css}">
    <link rel="stylesheet" th:href="@{/public/skinqln/vendor/ap8/css/style.css}">
    <link type="text/css" rel='stylesheet' th:href="@{/public/skinqln/vendor/font-awesome/css/font-awesome.min.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/public/skinqln/css/style.min.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/public/skinqln/css/custom.css}">


    <link th:href="@{/public/libs/jquery-ui-1.12.1.custom/jquery-ui.min.css}" rel="stylesheet" />

    <script type="text/javascript" th:src="@{/public/libs/jquery/jquery-3.3.1.min.js}"></script>
    <script type="text/javascript" th:src="@{/public/libs/bootstrap/js/bootstrap.min.js}"></script>
    <script type="text/javascript" th:src="@{/public/libs/datatable/js/jquery.dataTables.min.js}"></script>
    <script type="text/javascript" th:src="@{/public/libs/datatable/js/dataTables.bootstrap.js}"></script>
    <script type="text/javascript" th:src="@{/public/libs/datatable/js/fnAddTr.js}"></script>
    <script type="text/javascript" th:src="@{/public/libs/jquery-ui-1.12.1.custom/jquery-ui.min.js}"></script>
    <link th:href="@{/public/libs/bootstrap-datetimepicker/bootstrap-datetimepicker.min.css}" rel="stylesheet"
        media="screen">
    <script type="text/javascript" th:src="@{/public/libs/bootstrap-datetimepicker/moment.js}"></script>
    <script type="text/javascript"
        th:src="@{/public/libs/bootstrap-datetimepicker/bootstrap-datetimepicker.min.js}"></script>
    <script th:src="@{/public/libs/bootstrapdialog/bootstrap-dialog.min.js}"></script>
    <link rel="stylesheet" type="text/css" th:href="@{/public/libs/bootstrapdialog/dilogbootstrap.css}" />
    <script type="text/javascript" th:src="@{/public/js/qln/configs/ConfigApi.js}"></script>
    <script type="text/javascript" th:src="@{/public/js/qln/core/AuthenHelper.js}"></script>
    <script type="text/javascript" th:src="@{/public/js/qln/core/DataHelper.js}"></script>
    <script type="text/javascript" th:src="@{/public/js/qln/core/ControlHelper.js}"></script>
    <script type="text/javascript" th:src="@{/public/js/qln/app/ulti/Permisison.js}"></script>
    <script type="text/javascript" th:src="@{/public/libs/utils/Util.js}"></script>
    <script type="text/javascript" th:src="@{/public/libs/validate_form/jquery.validation.min.js}"></script>
    <script type="text/javascript" th:src="@{/public/libs/jqueryloading/jquery-loading.js}"></script>
    <link type="text/css" th:src="@{/public/libs/jqueryloading/jquery-loading.css}">
    </link>
    <script type="text/javascript" src="/qln/public/js/qln/model/NguoiDung.js"></script>
    <script type="text/javascript" src="/qln/public/js/qln/model/DonViTienTe.js"></script>
    <link type="text/css" th:src="@{/public/libs/bootbox.min.js}">
    </link>
    <link href="/qln/public/libs/utils/uploadfile.css" rel="stylesheet">
    <script src="/qln/public/libs/utils/jquery.uploadfile.js"></script>
    <script th:src="@{/public/libs/numeral.min.js}"></script>
    <link type="text/css" th:src="@{/public/libs/jquery.form.min.js}">
    </link>
    <script type="text/javascript" th:src="@{/public/libs/select2.full.min.js}"></script>
    <link rel="stylesheet" th:href="@{/public/libs/utils/select2.min.css}">
    <script type="text/javascript" src="/qln/public/js/qln/app/ulti/format.js"></script>
    <script th:src="@{/public/libs/jszip.js}"></script>
    <script th:src="@{/public/libs/xlsx.js}"></script>

    <script type="text/javascript" th:src="@{/public/js/qln/app/ulti/ExcellAction.js}"></script>
    <script type="text/javascript">

        const quickSort = (arr) => {

            if (arr.length < 2) return arr;

            // *** lấy phần tử cuối của 'arr' làm 'pivot'
            const pivotIndex = arr.length - 1;
            const pivot = arr[pivotIndex];

            const left = [];
            const right = [];

            let currentItem;
            // *** 'i < pivotIndex' => chúng ta sẽ không loop qua 'pivot' nữa
            for (let i = 0; i < pivotIndex; i++) {
                currentItem = arr[i];

                if (currentItem < pivot) {
                    left.push(currentItem);
                } else {
                    right.push(currentItem);
                }
            }

            return [...quickSort(right), pivot, ...quickSort(left)];
        }
        let xxxx = quickSort([2, 5, 3, 2, 1, 3, 0])
        var CurrentLayout = "Home";
        var DATA = new DataHelper();
        let token = JSON.parse(window.localStorage.getItem('AUTH'))
        var base64Url = token.split('.')[1];
        var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        var jsonPayload = decodeURIComponent(atob(base64).split('').map(function (c) {
            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(''));
        var jwt = JSON.parse(jsonPayload)
        function setCookie(cname, cvalue, exdays) {
            var d = new Date();
            d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
            var expires = "expires=" + d.toUTCString();
            document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
        }

        function uuidv4() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
                var r = Math.random() * 16 | 0,
                    v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        $(window).ready(function () {

            $(window).ready(function () {
                $('body').on('click', '#huongDanSuDung', function () {
                    oNguoiDung = new NguoiDung();
                    var url = oNguoiDung.getQuery();
                    window.open(url[0].VALUE_CONFIG_VARCHAR)
                })
                $('.modal').on('show.bs.modal', function (e) {
                    $('.modal .modal-content').css('width', window.innerWidth).css('height', window.innerHeight)
                    $('.modal div[role="document"]').css('width', '100%').css('margin-left', 0).css('margin', 0)
                    //$('.modal .modal-body').css('width', window.innerWidth).css('height', Number(window.innerHeight) - Number($('.modal-header').height()))
                })

                $('.modal#modalExport').on('show.bs.modal', function (e) {
                    $('.modal#modalExport .modal-content').attr('style', '').css('padding', 20)
                })

                $('.modal#modalImport').on('show.bs.modal', function (e) {
                    $('.modal#modalImport .modal-content').attr('style', '').css('padding', 20)
                })

                var link = document.querySelector("link[rel*='icon']") || document.createElement('link');
                link.type = 'image/x-icon';
                link.rel = 'shortcut icon';
                // link.href = 'http://www.stackoverflow.com/favicon.ico';
                link.href = 'http://www.iconarchive.com/download/i77830/custom-icon-design/pretty-office-11/cash.ico';
                document.getElementsByTagName('head')[0].appendChild(link);

                $('.wec-control-date').datetimepicker({
                    locale: 'vi',
                    format: 'DD/MM/YYYY',
                    useCurrent: false
                });
                $('.wec-control-datetime').datetimepicker({
                    locale: 'vi',
                    format: 'DD/MM/YYYY HH:mm:ss',
                    useCurrent: false
                });

                // lấy token từ localStorage và decode token a

                let id = jwt.id
                var userchecked = jwt.menu
                var trungpro = ''
                var element = ''
                var listli = ''
                var listcha = []
                var CountCha = 1;
                userchecked.map(function (value, index) {
                    var idcha = value.ID;
                    if (!value.IDCHA) {
                        listcha.push(value)
                        element = element + '<li class="dropdown menu_level_1">\
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">\
							' + CountCha++ + '. ' + fnc_nvl(value.NAME, '') + '<span class="caret"></span>\
						</a>\
						<ul class="dropdown-menu" role="menu">\
								<li id="' + value.ID + '" class="active menu_level_2">\
							</li>\
							</ul>\
					</li>'

                    }
                })

                $("#topnav-bar").append(element)
                for (i = 0; i < listcha.length; i++) {
                    listli = ''
                    let countcon = 1
                    for (j = 0; j < userchecked.length; j++) {
                        if (userchecked[j].IDCHA === listcha[i].ID) {
                            if (userchecked[j].URL == "#2") {
                                listli = listli + '<a id="huongDanSuDung" href="' + userchecked[j].URL + '">' + countcon++ + '. ' + userchecked[j].NAME + '</a>'
                            } else {
                                listli = listli + '<a href="' + userchecked[j].URL + '">' + countcon++ + '. ' + userchecked[j].NAME + '</a>'
                            }
                        }
                    }
                    $("#" + listcha[i].ID + "").append(listli)
                }
            })

        })

        function CheckRoleAct(pTokenJWT) {
            pTokenJWT.role.map(function (el) {
                $('.' + el.split('.')[0] + ' .' + el.split('.')[0]).css('display', 'block');
            })
        }
    </script>

    <style>
        label {
            font-size: 15px !important;
        }

        input {
            font-size: 15px !important;
        }

        #btnDelete {
            display: none;
        }

        #btnAddNew {
            display: none;
        }

        #btnEdit {
            display: none;
        }

        #btnPhanQuyen {
            display: none;
        }

        #btnTraLai {
            display: none;
        }

        #btnPheDuyetDuToan {
            display: none;
        }

        #btnLichsu {
            display: none;
        }

        #btnTroNo {
            display: none;
        }

        #btnResetpassword {
            display: none;
        }

        .modal-content {
            overflow: auto !important;
        }

        .select2 {
            width: 100% !important;
        }
    </style>
    <style>
        .btn-notification {
            position: fixed;
            z-index: 999;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 100px;
            cursor: pointer;
            text-align: center;
            line-height: 60px;
        }

        .btn-notification span {
            position: absolute;
            left: 50%;
            transform: translate(-50%);
            color: white;
        }

        .btn-notification::after {
            content: '';
            width: 50px;
            height: 50px;
            border-radius: 100px;
            position: absolute;
            top: 0px;
            left: 0px;
            z-index: -5px;
            border: 1px solid green;
            animation: notification1 1s infinite;
            -webkit-animation: notification1 1s infinite;
        }

        .btn-notification::before {
            content: '';
            width: 50px;
            z-index: -2;
            top: 0px;
            left: 0px;
            height: 50px;
            border-radius: 100px;
            position: absolute;
            border: 1px solid green;
            animation: notification2 2s infinite;
            -webkit-animation: notification2 2s infinite;
        }

        .btn-notification i {
            font-size: 36px;
            color: red;
            z-index: 1;
            animation: notification 2s infinite;
            -webkit-animation: notification 2s infinite;
        }

        .notification .slider-left {
            display: none;
            height: 100%;
            position: fixed;
            top: 85px;
            left: 0px;
            z-index: 9999;
            background-color: white;
            border-top-right-radius: 5px;
            border-bottom-right-radius: 10px;
            animation: slidenotification 1s;
            border: 1px solid #337ab7;
        }

        @-webkit-keyframes slidenotification {
            0% {
                transform: translate(-200px);
            }

            50% {
                transform: rotateZ(-100px);
            }

            100% {
                transform: rotateZ(0px);
            }
        }

        @keyframes slidenotification {
            0% {
                transform: translate(-200px);
            }

            50% {
                transform: rotateZ(-100px);
            }

            100% {
                transform: rotateZ(0px);
            }
        }

        @-webkit-keyframes notification {
            0% {
                transform: rotateZ(-30deg);
            }

            50% {
                transform: rotateZ(30deg);
            }

            100% {
                transform: rotateZ(-30deg);
            }
        }

        @keyframes notification {
            0% {
                transform: rotateZ(-30deg);
            }

            50% {
                transform: rotateZ(30deg);
            }

            100% {
                transform: rotateZ(-30deg);
            }
        }

        @-webkit-keyframes notification1 {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.2);
            }

            100% {
                transform: rotateZ(1);
            }
        }

        @keyframes notification1 {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.2);
            }

            100% {
                transform: rotateZ(1);
            }
        }

        @-webkit-keyframes notification2 {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.4);
            }

            100% {
                transform: rotateZ(1);
            }
        }

        @keyframes notification2 {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.4);
            }

            100% {
                transform: rotateZ(1);
            }
        }
    </style>
</head>

<body id="QLN">
    <div class="wrapper-canvas">

        <div class="header">
            <div th:replace="modules/header::header"></div>
        </div>
        <div class="notification">
            <div th:replace="modules/notification::notification"></div>
        </div>
        <div id="MenuNgang">
            <div th:replace="modules/topnav::topnav"></div>
        </div>
        <div class="main-content">
            <div class="content">
                <div th:replace="modules/topaction::topaction"></div>
                <div layout:fragment="content"></div>
            </div>
            <div class="content">
                <div layout:fragment="topaction"></div>
                <div layout:fragment="content-home"></div>
            </div>
        </div>
        <div th:replace="modules/popup :: popup"></div>
    </div>
    <script>
        $(document).ready(function () {
            var itiente = new DonViTienTe()
            itiente.getAll()
            var listtiente = itiente.LIST
            localStorage.TIENTE = JSON.stringify(listtiente);

            if ('BCQUANTRI@BCTheothongtu@BCTT80@BCKHAC'.includes(CurrentLayout)) {
                $("select").select2({});
            } else {
                $("select").select2({
                    dropdownParent: $("#exampleModalCenter")
                });
            }


            var trung = '            '
            $("#dangnhapboi").text('Xin chào ' + jwt.userName)
            // if (CurrentLayout === 'DASHBOARD') {
            // 	$(".topaction").hide();
            // }
            if (CurrentLayout == 'TOCHUCMUATP') {
                $("#btnTraLai").show();

            } else {
                $("#btnTraLai").hide();
            }
            if (CurrentLayout == 'VAYHANGNAM') {
                $("#btnPheDuyetDuToan").show();
            }
            else {
                $("#btnPheDuyetDuToan").hide();
            }
            if (CurrentLayout == 'USER') {
                $("#btnPhanQuyen").show();
                $("#btnResetpassword").show();
                $("#btnExportTemplate").hide()
                $("#btnImport").hide()
                $("#btnExport").hide()

            } else {
                $("#btnPhanQuyen").hide();
                $("#btnResetpassword").hide();
                $("#btnExportTemplate").show()
                $("#btnImport").show()
                $("#btnExport").show()
            }


            if (CurrentLayout == 'BCTHEOTHONGTU' || CurrentLayout == 'BCQUANTRI' || CurrentLayout == 'BCTT80' || CurrentLayout == 'BCKHAC' || CurrentLayout == 'DASHBOARD') {
                $(".topaction").hide();
            } else {
                $(".topaction").show()
            }
            if (CurrentLayout == 'VAYKBNN' || CurrentLayout == 'VAYVDB' || CurrentLayout == 'VAYTCTD' || CurrentLayout == 'VAYQUYDUTRUTINH') {
                $("#btnTroNo").show()
            } else {
                $("#btnTroNo").hide()
            }

            var deletee = CurrentLayout + '.DELETE'
            var read = CurrentLayout + '.READ'
            var create = CurrentLayout + '.CREATE'
            var edit = CurrentLayout + '.EDIT'
            var phanquyen = CurrentLayout + '.PHANQUYEN'
            // jwt.role.map(function (el) {
            // 	if (CurrentLayout === el.split('.')[0]) {
            // 		$($($('.content').children()[0]).children()[0]).children().each(function (index, el1) {
            // 			$(".topaction ." + el.split('.')[1]).css('display', 'inline-block')
            // 		})
            // 	}


            // })

            var el = jwt.role

            var a = 0
            var a1 = 0
            var a2 = 0
            var a3 = 0
            // setTimeout(() => {
            //     if (el.indexOf(deletee) >= 0) {
            //         $("#btnDelete").show();
            //         a = 1
            //     }
            // }, 500);
            // setTimeout(() => {
            //     if (el.indexOf(create) >= 0) {
            //         $("#btnAddNew").show();
            //         a1 = 1
            //     }
            // }, 500);
            // setTimeout(() => {
            //     if (el.indexOf(edit) >= 0) {
            //         $("#btnEdit").show();
            //         a2 = 1
            //     }
            // }, 500);
            if (el.indexOf(deletee) >= 0) {
                $("#btnDelete").show();
                a = 1
            }
            if (el.indexOf(create) >= 0) {
                $("#btnAddNew").show();
                a1 = 1
            }
            if (el.indexOf(edit) >= 0) {
                $("#btnEdit").show();
                a2 = 1
            }
            if (el.indexOf(phanquyen) >= 0) {
                $("#btnPhanQuyen").show();
                a3 = 1
            }
            if ((a + a1 + a2 + a3) == 0) {
                $(".topaction").hide();
            }
            $('.donviid').html(fnc_danhsachdonvi()).select2()
        })
    </script>
    <div id="modalRject" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <!-- dialog body -->
                <div class="modal-body">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <form class="form-inline" id="fomr-reject">
                        <div class="row">
                            <div class="col-sm-4">
                                <label for="DECRIPTION" style="color: brown;">Lí do từ chối</label>
                            </div>
                            <div class="col-sm-7">
                                <textarea class="form-control" id="DECRIPTION" placeholder="Lí do từ chối....." rows="3"
                                    style="min-height: 200px; width: 100%;"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-primary" id="btnConfirmReject">Xác
                        nhận</button></div>
            </div>
        </div>
    </div>
    <div id="modalExport" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <!-- dialog body -->
                <div class="modal-body">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <div class="row">
                        <form>
                            <div class="form-group">
                                <label for="formGroupExampleInput">Đơn vị</label>
                                <select type="text" class="form-control donviid" id="DONVIID" placeholder="Chọn đơn vị">
                                </select>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="modal-footer" style="border: 0px;"><button type="button" class="btn btn-primary"
                        id="btnConfirmExport">Xác
                        nhận</button> <button type="button" class="btn btn-danger" data-dismiss="modal">Đóng </button>
                </div>
            </div>
        </div>
    </div>
    <div id="modalImport" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <!-- dialog body -->
                <div class="modal-body">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <div class="row">
                        <div class="form-group">
                            <label for="formGroupExampleInput">Đơn vị</label>
                            <select type="text" class="form-control donviid" id="DONVIID" placeholder="Chọn đơn vị">
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="formGroupExampleInput" style="display: block;">File</label>
                            <input type="file" class="form-control" id="FILEIMPORT" style="height: 40px !important;">
                        </div>
                    </div>
                </div>
                <div class="modal-footer" style="border: 0px;"><button type="button" class="btn btn-primary"
                        id="btnConfirmImport">Xác
                        nhận</button><button type="button" class="btn btn-danger" data-dismiss="modal">Đóng </button>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript" th:src="@{/public/js/qln/app/ulti/Ulti.js}"></script>
    <script type="text/javascript" src="/qln/public/js/qln/app/ulti/pheduyet.js"></script>
    <script type="text/javascript" src="/qln/public/js/qln/app/notification/notification.js"></script>
</body>

</html>